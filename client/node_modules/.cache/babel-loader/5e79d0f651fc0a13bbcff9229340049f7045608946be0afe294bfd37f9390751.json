{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ParseArrayPipe = void 0;\nconst tslib_1 = require(\"tslib\");\nconst injectable_decorator_1 = require(\"../decorators/core/injectable.decorator\");\nconst optional_decorator_1 = require(\"../decorators/core/optional.decorator\");\nconst http_status_enum_1 = require(\"../enums/http-status.enum\");\nconst http_error_by_code_util_1 = require(\"../utils/http-error-by-code.util\");\nconst shared_utils_1 = require(\"../utils/shared.utils\");\nconst validation_pipe_1 = require(\"./validation.pipe\");\nconst VALIDATION_ERROR_MESSAGE = 'Validation failed (parsable array expected)';\nconst DEFAULT_ARRAY_SEPARATOR = ',';\n/**\n * Defines the built-in ParseArray Pipe\n *\n * @see [Built-in Pipes](https://docs.nestjs.com/pipes#built-in-pipes)\n *\n * @publicApi\n */\nlet ParseArrayPipe = class ParseArrayPipe {\n  constructor(options = {}) {\n    this.options = options;\n    this.validationPipe = new validation_pipe_1.ValidationPipe({\n      transform: true,\n      validateCustomDecorators: true,\n      ...options\n    });\n    const {\n      exceptionFactory,\n      errorHttpStatusCode = http_status_enum_1.HttpStatus.BAD_REQUEST\n    } = options;\n    this.exceptionFactory = exceptionFactory || (error => new http_error_by_code_util_1.HttpErrorByCode[errorHttpStatusCode](error));\n  }\n  /**\n   * Method that accesses and performs optional transformation on argument for\n   * in-flight requests.\n   *\n   * @param value currently processed route argument\n   * @param metadata contains metadata about the currently processed route argument\n   */\n  async transform(value, metadata) {\n    if (!value && !this.options.optional) {\n      throw this.exceptionFactory(VALIDATION_ERROR_MESSAGE);\n    } else if ((0, shared_utils_1.isNil)(value) && this.options.optional) {\n      return value;\n    }\n    if (!Array.isArray(value)) {\n      if (!(0, shared_utils_1.isString)(value)) {\n        throw this.exceptionFactory(VALIDATION_ERROR_MESSAGE);\n      } else {\n        try {\n          value = value.trim().split(this.options.separator || DEFAULT_ARRAY_SEPARATOR);\n        } catch {\n          throw this.exceptionFactory(VALIDATION_ERROR_MESSAGE);\n        }\n      }\n    }\n    if (this.options.items) {\n      const validationMetadata = {\n        metatype: this.options.items,\n        type: 'query'\n      };\n      const isExpectedTypePrimitive = this.isExpectedTypePrimitive();\n      const toClassInstance = (item, index) => {\n        if (this.options.items !== String) {\n          try {\n            item = JSON.parse(item);\n          } catch {\n            // Do nothing\n          }\n        }\n        if (isExpectedTypePrimitive) {\n          return this.validatePrimitive(item, index);\n        }\n        return this.validationPipe.transform(item, validationMetadata);\n      };\n      if (this.options.stopAtFirstError === false) {\n        // strict compare to \"false\" to make sure\n        // that this option is disabled by default\n        let errors = [];\n        const targetArray = value;\n        for (let i = 0; i < targetArray.length; i++) {\n          try {\n            targetArray[i] = await toClassInstance(targetArray[i]);\n          } catch (err) {\n            let message;\n            if (err.getResponse) {\n              const response = err.getResponse();\n              if (Array.isArray(response.message)) {\n                message = response.message.map(item => `[${i}] ${item}`);\n              } else {\n                message = `[${i}] ${response.message}`;\n              }\n            } else {\n              message = err;\n            }\n            errors = errors.concat(message);\n          }\n        }\n        if (errors.length > 0) {\n          throw this.exceptionFactory(errors);\n        }\n        return targetArray;\n      } else {\n        value = await Promise.all(value.map(toClassInstance));\n      }\n    }\n    return value;\n  }\n  isExpectedTypePrimitive() {\n    return [Boolean, Number, String].includes(this.options.items);\n  }\n  validatePrimitive(originalValue, index) {\n    if (this.options.items === Number) {\n      const value = originalValue !== null && originalValue !== '' ? +originalValue : NaN;\n      if (isNaN(value)) {\n        throw this.exceptionFactory(`${(0, shared_utils_1.isUndefined)(index) ? '' : `[${index}] `}item must be a number`);\n      }\n      return value;\n    } else if (this.options.items === String) {\n      if (!(0, shared_utils_1.isString)(originalValue)) {\n        return `${originalValue}`;\n      }\n    } else if (this.options.items === Boolean) {\n      if (typeof originalValue !== 'boolean') {\n        throw this.exceptionFactory(`${(0, shared_utils_1.isUndefined)(index) ? '' : `[${index}] `}item must be a boolean value`);\n      }\n    }\n    return originalValue;\n  }\n};\nexports.ParseArrayPipe = ParseArrayPipe;\nexports.ParseArrayPipe = ParseArrayPipe = tslib_1.__decorate([(0, injectable_decorator_1.Injectable)(), tslib_1.__param(0, (0, optional_decorator_1.Optional)()), tslib_1.__metadata(\"design:paramtypes\", [Object])], ParseArrayPipe);","map":{"version":3,"names":["Object","defineProperty","exports","value","ParseArrayPipe","tslib_1","require","injectable_decorator_1","optional_decorator_1","http_status_enum_1","http_error_by_code_util_1","shared_utils_1","validation_pipe_1","VALIDATION_ERROR_MESSAGE","DEFAULT_ARRAY_SEPARATOR","constructor","options","validationPipe","ValidationPipe","transform","validateCustomDecorators","exceptionFactory","errorHttpStatusCode","HttpStatus","BAD_REQUEST","error","HttpErrorByCode","metadata","optional","isNil","Array","isArray","isString","trim","split","separator","items","validationMetadata","metatype","type","isExpectedTypePrimitive","toClassInstance","item","index","String","JSON","parse","validatePrimitive","stopAtFirstError","errors","targetArray","i","length","err","message","getResponse","response","map","concat","Promise","all","Boolean","Number","includes","originalValue","NaN","isNaN","isUndefined","__decorate","Injectable","__param","Optional","__metadata"],"sources":["C:/Users/Fran/Documents/OlavarraFps/clase1/AFIPNest/proyecto-nombre/node_modules/@nestjs/common/pipes/parse-array.pipe.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ParseArrayPipe = void 0;\nconst tslib_1 = require(\"tslib\");\nconst injectable_decorator_1 = require(\"../decorators/core/injectable.decorator\");\nconst optional_decorator_1 = require(\"../decorators/core/optional.decorator\");\nconst http_status_enum_1 = require(\"../enums/http-status.enum\");\nconst http_error_by_code_util_1 = require(\"../utils/http-error-by-code.util\");\nconst shared_utils_1 = require(\"../utils/shared.utils\");\nconst validation_pipe_1 = require(\"./validation.pipe\");\nconst VALIDATION_ERROR_MESSAGE = 'Validation failed (parsable array expected)';\nconst DEFAULT_ARRAY_SEPARATOR = ',';\n/**\n * Defines the built-in ParseArray Pipe\n *\n * @see [Built-in Pipes](https://docs.nestjs.com/pipes#built-in-pipes)\n *\n * @publicApi\n */\nlet ParseArrayPipe = class ParseArrayPipe {\n    constructor(options = {}) {\n        this.options = options;\n        this.validationPipe = new validation_pipe_1.ValidationPipe({\n            transform: true,\n            validateCustomDecorators: true,\n            ...options,\n        });\n        const { exceptionFactory, errorHttpStatusCode = http_status_enum_1.HttpStatus.BAD_REQUEST } = options;\n        this.exceptionFactory =\n            exceptionFactory ||\n                (error => new http_error_by_code_util_1.HttpErrorByCode[errorHttpStatusCode](error));\n    }\n    /**\n     * Method that accesses and performs optional transformation on argument for\n     * in-flight requests.\n     *\n     * @param value currently processed route argument\n     * @param metadata contains metadata about the currently processed route argument\n     */\n    async transform(value, metadata) {\n        if (!value && !this.options.optional) {\n            throw this.exceptionFactory(VALIDATION_ERROR_MESSAGE);\n        }\n        else if ((0, shared_utils_1.isNil)(value) && this.options.optional) {\n            return value;\n        }\n        if (!Array.isArray(value)) {\n            if (!(0, shared_utils_1.isString)(value)) {\n                throw this.exceptionFactory(VALIDATION_ERROR_MESSAGE);\n            }\n            else {\n                try {\n                    value = value\n                        .trim()\n                        .split(this.options.separator || DEFAULT_ARRAY_SEPARATOR);\n                }\n                catch {\n                    throw this.exceptionFactory(VALIDATION_ERROR_MESSAGE);\n                }\n            }\n        }\n        if (this.options.items) {\n            const validationMetadata = {\n                metatype: this.options.items,\n                type: 'query',\n            };\n            const isExpectedTypePrimitive = this.isExpectedTypePrimitive();\n            const toClassInstance = (item, index) => {\n                if (this.options.items !== String) {\n                    try {\n                        item = JSON.parse(item);\n                    }\n                    catch {\n                        // Do nothing\n                    }\n                }\n                if (isExpectedTypePrimitive) {\n                    return this.validatePrimitive(item, index);\n                }\n                return this.validationPipe.transform(item, validationMetadata);\n            };\n            if (this.options.stopAtFirstError === false) {\n                // strict compare to \"false\" to make sure\n                // that this option is disabled by default\n                let errors = [];\n                const targetArray = value;\n                for (let i = 0; i < targetArray.length; i++) {\n                    try {\n                        targetArray[i] = await toClassInstance(targetArray[i]);\n                    }\n                    catch (err) {\n                        let message;\n                        if (err.getResponse) {\n                            const response = err.getResponse();\n                            if (Array.isArray(response.message)) {\n                                message = response.message.map((item) => `[${i}] ${item}`);\n                            }\n                            else {\n                                message = `[${i}] ${response.message}`;\n                            }\n                        }\n                        else {\n                            message = err;\n                        }\n                        errors = errors.concat(message);\n                    }\n                }\n                if (errors.length > 0) {\n                    throw this.exceptionFactory(errors);\n                }\n                return targetArray;\n            }\n            else {\n                value = await Promise.all(value.map(toClassInstance));\n            }\n        }\n        return value;\n    }\n    isExpectedTypePrimitive() {\n        return [Boolean, Number, String].includes(this.options.items);\n    }\n    validatePrimitive(originalValue, index) {\n        if (this.options.items === Number) {\n            const value = originalValue !== null && originalValue !== '' ? +originalValue : NaN;\n            if (isNaN(value)) {\n                throw this.exceptionFactory(`${(0, shared_utils_1.isUndefined)(index) ? '' : `[${index}] `}item must be a number`);\n            }\n            return value;\n        }\n        else if (this.options.items === String) {\n            if (!(0, shared_utils_1.isString)(originalValue)) {\n                return `${originalValue}`;\n            }\n        }\n        else if (this.options.items === Boolean) {\n            if (typeof originalValue !== 'boolean') {\n                throw this.exceptionFactory(`${(0, shared_utils_1.isUndefined)(index) ? '' : `[${index}] `}item must be a boolean value`);\n            }\n        }\n        return originalValue;\n    }\n};\nexports.ParseArrayPipe = ParseArrayPipe;\nexports.ParseArrayPipe = ParseArrayPipe = tslib_1.__decorate([\n    (0, injectable_decorator_1.Injectable)(),\n    tslib_1.__param(0, (0, optional_decorator_1.Optional)()),\n    tslib_1.__metadata(\"design:paramtypes\", [Object])\n], ParseArrayPipe);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}